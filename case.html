<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Latin Noun Quiz</title>
  <style>
    body { font-family: sans-serif; padding: 10px; background: #f0f0f5; }
    h2, h3 { text-align: center; }
    .case-box {
      min-height: 80px;
      padding: 10px;
      margin: 10px;
      background: #fff;
      border: 2px dashed #aaa;
      border-radius: 10px;
      flex: 1 1 30%;
      text-align: center;
    }
    .noun-button {
      background: #e0f7fa;
      border: 1px solid #00796b;
      border-radius: 5px;
      margin: 5px;
      padding: 10px;
      font-size: 1rem;
      display: inline-block;
      cursor: pointer;
    }
    .correct { background: #c8e6c9 !important; }
    .incorrect { background: #ffcdd2 !important; }
    .container {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
    }
    .controls, #wordBank, #caseArea {
      text-align: center;
      margin: 10px auto;
      max-width: 800px;
    }
    button { margin: 5px; padding: 10px 15px; font-size: 1rem; }
  </style>
</head>
<body>
<h2>Latin Noun Quiz – Touch to Match</h2>

<div id="menu">
  <h3>Select Cases</h3>
  <label><input type="checkbox" value="Nominative" checked> Nominative</label>
  <label><input type="checkbox" value="Genitive" checked> Genitive</label>
  <label><input type="checkbox" value="Dative/Ablative" checked> Dative/Ablative</label>
  <label><input type="checkbox" value="Accusative" checked> Accusative</label>
  <br><br>
  <button onclick="startQuiz()">Start</button>
</div>

<div class="controls" id="quizControls" style="display:none;">
  <h3 id="setTitle"></h3>
  <button onclick="prevSet()">Previous</button>
  <button onclick="checkAnswers()">Check Answers</button>
  <button onclick="reset()">Reset</button>
  <button onclick="nextSet()">Next</button>
</div>

<div id="caseArea" class="container"></div>

<h3>Word Bank</h3>
<div id="wordBank"></div>

<audio id="correctSound" src="https://www.soundjay.com/buttons/sounds/button-4.mp3" preload="auto"></audio>

<script>
const nounSets = [
  { name: "puella (f)", nouns: [["puella", "Nominative"], ["puellae", "Genitive"], ["puellae", "Dative/Ablative"], ["puellam", "Accusative"], ["puella", "Dative/Ablative"], ["puellae", "Nominative"], ["puellarum", "Genitive"], ["puellis", "Dative/Ablative"], ["puellas", "Accusative"], ["puellis", "Dative/Ablative"]] },
  { name: "servus (m)", nouns: [["servus", "Nominative"], ["servi", "Genitive"], ["servo", "Dative/Ablative"], ["servum", "Accusative"], ["servo", "Dative/Ablative"], ["servi", "Nominative"], ["servorum", "Genitive"], ["servis", "Dative/Ablative"], ["servos", "Accusative"], ["servis", "Dative/Ablative"]] },
  { name: "templum (n)", nouns: [["templum", "Nominative"], ["templi", "Genitive"], ["templo", "Dative/Ablative"], ["templum", "Accusative"], ["templo", "Dative/Ablative"], ["templa", "Nominative"], ["templorum", "Genitive"], ["templis", "Dative/Ablative"], ["templa", "Accusative"], ["templis", "Dative/Ablative"]] },
  { name: "vir (m)", nouns: [["vir", "Nominative"], ["viri", "Genitive"], ["viro", "Dative/Ablative"], ["virum", "Accusative"], ["viro", "Dative/Ablative"], ["viri", "Nominative"], ["virorum", "Genitive"], ["viris", "Dative/Ablative"], ["viros", "Accusative"], ["viris", "Dative/Ablative"]] },
  { name: "oppidum (n)", nouns: [["oppidum", "Nominative"], ["oppidi", "Genitive"], ["oppido", "Dative/Ablative"], ["oppidum", "Accusative"], ["oppido", "Dative/Ablative"], ["oppida", "Nominative"], ["oppidorum", "Genitive"], ["oppidis", "Dative/Ablative"], ["oppida", "Accusative"], ["oppidis", "Dative/Ablative"]] },
  { name: "fluvius (m)", nouns: [["fluvius", "Nominative"], ["fluvii", "Genitive"], ["fluvio", "Dative/Ablative"], ["fluvium", "Accusative"], ["fluvio", "Dative/Ablative"], ["fluvii", "Nominative"], ["fluviōrum", "Genitive"], ["fluviīs", "Dative/Ablative"], ["fluvios", "Accusative"], ["fluviīs", "Dative/Ablative"]] },
  { name: "puer (m)", nouns: [["puer", "Nominative"], ["pueri", "Genitive"], ["puero", "Dative/Ablative"], ["puerum", "Accusative"], ["puero", "Dative/Ablative"], ["pueri", "Nominative"], ["puerorum", "Genitive"], ["pueris", "Dative/Ablative"], ["pueros", "Accusative"], ["pueris", "Dative/Ablative"]] },
  { name: "terra (f)", nouns: [["terra", "Nominative"], ["terrae", "Genitive"], ["terrae", "Dative/Ablative"], ["terram", "Accusative"], ["terra", "Dative/Ablative"], ["terrae", "Nominative"], ["terrarum", "Genitive"], ["terris", "Dative/Ablative"], ["terras", "Accusative"], ["terris", "Dative/Ablative"]] }
];

let selectedCases = [];
let currentSet = 0;
let activeNoun = null;

function startQuiz() {
  selectedCases = Array.from(document.querySelectorAll('#menu input[type=checkbox]:checked')).map(cb => cb.value);
  if (!selectedCases.length) return alert("Select at least one case.");
  document.getElementById("menu").style.display = "none";
  document.getElementById("quizControls").style.display = "block";
  renderSet();
}

function renderSet() {
  activeNoun = null;
  const nounData = nounSets[currentSet];
  document.getElementById("setTitle").innerText = nounData.name;
  document.getElementById("caseArea").innerHTML = "";
  document.getElementById("wordBank").innerHTML = "";

  const caseArea = document.getElementById("caseArea");
  selectedCases.forEach(c => {
    const box = document.createElement("div");
    box.className = "case-box";
    box.dataset.case = c;
    box.innerHTML = `<h4>${c}</h4>`;
    box.onclick = () => {
      if (activeNoun) {
        placeNoun(box);
      }
    };
    caseArea.appendChild(box);
  });

  nounData.nouns.filter(([_, c]) => selectedCases.includes(c)).forEach(([form, c], i) => {
    const btn = document.createElement("div");
    btn.className = "noun-button";
    btn.innerText = form;
    btn.dataset.case = c;
    btn.dataset.original = form + "-" + i;  // Ensure uniqueness
    btn.onclick = () => toggleActive(btn);
    document.getElementById("wordBank").appendChild(btn);
  });
}

function toggleActive(btn) {
  if (activeNoun === btn) {
    activeNoun = null;
    btn.style.outline = "";
  } else {
    if (activeNoun) activeNoun.style.outline = "";
    activeNoun = btn;
    btn.style.outline = "3px solid blue";
  }
}

function placeNoun(box) {
  const newBtn = activeNoun.cloneNode(true);
  newBtn.onclick = () => {
    document.getElementById("wordBank").appendChild(newBtn);
    newBtn.classList.remove("correct", "incorrect");
  };
  box.appendChild(newBtn);
  activeNoun.remove();
  activeNoun = null;
}

function checkAnswers() {
  let allCorrect = true;
  document.getElementById("correctSound").currentTime = 0;

  document.querySelectorAll(".case-box").forEach(box => {
    const expected = box.dataset.case;
    [...box.children].forEach(child => {
      if (child.classList.contains("noun-button")) {
        if (child.dataset.case === expected || (expected === "Dative/Ablative" && ["Dative/Ablative", "Dative", "Ablative"].includes(child.dataset.case))) {
          child.classList.add("correct");
          child.classList.remove("incorrect");
        } else {
          child.classList.add("incorrect");
          child.classList.remove("correct");
          allCorrect = false;
        }
      }
    });
  });

  if (allCorrect) {
    document.getElementById("correctSound").play();
    setTimeout(nextSet, 1000);
  }
}

function reset() {
  renderSet();
}

function nextSet() {
  currentSet = (currentSet + 1) % nounSets.length;
  renderSet();
}

function prevSet() {
  currentSet = (currentSet - 1 + nounSets.length) % nounSets.length;
  renderSet();
}
</script>
</body>
</html>
